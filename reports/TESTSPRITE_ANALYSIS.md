# TestSprite ν”„λ΅μ νΈ λ¶„μ„ λ³΄κ³ μ„

## π“‹ ν”„λ΅μ νΈ κ°μ”

**ν”„λ΅μ νΈ μ΄λ¦„**: AI λ°°λ‹Ήμ†”λ£¨μ…  
**λ°±μ—”λ“ νƒ€μ…**: Flask REST API  
**ν…μ¤νΈ λ²”μ„**: `us_market` ν΄λ” κΈ°μ¤€  
**λ¶„μ„ μΌμ‹**: 2025-01-17

---

## π—οΈ ν”„λ΅μ νΈ μ•„ν‚¤ν…μ²

### λ””λ ‰ν† λ¦¬ κµ¬μ΅°

```
AI λ°°λ‹Ήμ†”λ£¨μ…/
β”β”€β”€ us_market/                    # λ°±μ—”λ“ ν•µμ‹¬ λ¨λ“
β”‚   β”β”€β”€ dividend/
β”‚   β”‚   β”β”€β”€ config/               # μ„¤μ • νμΌ
β”‚   β”‚   β”‚   β”β”€β”€ dividend_plans.json
β”‚   β”‚   β”‚   β””β”€β”€ tags.json
β”‚   β”‚   β”β”€β”€ data/                # λ°μ΄ν„° νμΌ
β”‚   β”‚   β”‚   β”β”€β”€ universe_seed.json
β”‚   β”‚   β”‚   β””β”€β”€ dividend_universe.json
β”‚   β”‚   β”β”€β”€ engine.py            # ν¬νΈν΄λ¦¬μ¤ μƒμ„± μ—”μ§„
β”‚   β”‚   β”β”€β”€ dividend_analyzer.py # λ°°λ‹Ή λ¶„μ„κΈ°
β”‚   β”‚   β”β”€β”€ portfolio_optimizer.py # ν¬νΈν΄λ¦¬μ¤ μµμ ν™”
β”‚   β”‚   β”β”€β”€ risk_analytics.py    # λ¦¬μ¤ν¬ λ¶„μ„
β”‚   β”‚   β”β”€β”€ backtest.py          # λ°±ν…μ¤νΈ μ—”μ§„
β”‚   β”‚   β””β”€β”€ loader.py            # λ°μ΄ν„° λ΅λ”
β”‚   β””β”€β”€ tests/                   # ν…μ¤νΈ μ¤μ„νΈ
β”‚       β”β”€β”€ test_engine.py
β”‚       β”β”€β”€ test_dividend_analyzer.py
β”‚       β”β”€β”€ test_portfolio_optimizer.py
β”‚       β”β”€β”€ test_risk_analytics.py
β”‚       β”β”€β”€ test_backtest.py
β”‚       β””β”€β”€ test_flask_api.py
β”β”€β”€ flask_app.py                 # Flask μ• ν”λ¦¬μΌ€μ΄μ…
β”β”€β”€ templates/                   # HTML ν…ν”λ¦Ώ
β””β”€β”€ requirements.txt            # μμ΅΄μ„±
```

### ν•µμ‹¬ λ¨λ“

1. **DividendEngine** (`engine.py`)
   - ν¬νΈν΄λ¦¬μ¤ μƒμ„± λ° μµμ ν™”
   - ν…λ§/ν‹°μ–΄ κΈ°λ° ν¬νΈν΄λ¦¬μ¤ κµ¬μ„±
   - ν•„ν„°λ§ λ° μ μ•½ μ΅°κ±΄ μ μ©

2. **DividendAnalyzer** (`dividend_analyzer.py`)
   - λ°°λ‹Ή μ§€μ†κ°€λ¥μ„± λ¶„μ„
   - Payout Ratio, μ„±μ¥λ¥ , μ—°μ† μ§€κΈ‰ μ—°μ κ³„μ‚°
   - μ•μ „μ„± μ μ μ‚°μ¶

3. **PortfolioOptimizer** (`portfolio_optimizer.py`)
   - Risk Parity μµμ ν™”
   - Max Sharpe μµμ ν™”
   - ν†µν•© μµμ ν™” μΈν„°νμ΄μ¤

4. **RiskAnalytics** (`risk_analytics.py`)
   - λ³€λ™μ„± κ³„μ‚°
   - μµλ€ λ‚™ν­ κ³„μ‚°
   - Sharpe Ratio κ³„μ‚°

5. **BacktestEngine** (`backtest.py`)
   - κ³Όκ±° λ°μ΄ν„° κΈ°λ° λ°±ν…μ¤νΈ
   - μμµλ¥  λ° λ¦¬μ¤ν¬ λ©”νΈλ¦­ κ³„μ‚°
   - λ²¤μΉλ§ν¬ λΉ„κµ

---

## π” API μ—”λ“ν¬μΈνΈ λ¶„μ„

### νμ΄μ§€ λΌμ°νΈ

| Method | Endpoint | μ„¤λ… | μƒνƒ μ½”λ“ |
|--------|----------|------|----------|
| GET | `/` | λλ”© νμ΄μ§€ | 200 |
| GET | `/app` | λ€μ‹λ³΄λ“ | 200 |
| GET | `/dividend` | λ°°λ‹Ή UI νμ΄μ§€ | 200 |

### REST API μ—”λ“ν¬μΈνΈ

| Method | Endpoint | μ„¤λ… | μ”μ²­ λ³Έλ¬Έ | μ‘λ‹µ ν•μ‹ |
|--------|----------|------|----------|----------|
| GET | `/api/dividend/themes` | ν…λ§ λ©λ΅ μ΅°ν | - | JSON Array |
| POST | `/api/dividend/all-tiers` | 3κ° ν‹°μ–΄ ν¬νΈν΄λ¦¬μ¤ μƒμ„± | JSON | JSON Object |
| GET | `/api/dividend/risk-metrics/<ticker>` | λ¦¬μ¤ν¬ μ§€ν‘ μ΅°ν | Query: period | JSON Object |
| GET | `/api/dividend/sustainability/<ticker>` | λ°°λ‹Ή μ§€μ†μ„± λ¶„μ„ | - | JSON Object |
| POST | `/api/dividend/optimize-advanced` | κ³ κΈ‰ μµμ ν™” | JSON | JSON Object |
| POST | `/api/dividend/backtest` | λ°±ν…μ¤νΈ μ‹¤ν–‰ | JSON | JSON Object |

### API μƒμ„Έ μ¤ν™

#### 1. GET `/api/dividend/themes`
**μ„¤λ…**: μ‚¬μ© κ°€λ¥ν• λ°°λ‹Ή ν…λ§ λ©λ΅ μ΅°ν

**μ‘λ‹µ μμ‹**:
```json
[
  {
    "id": "max_monthly_income",
    "title": "μ›”λ°°λ‹Ή μµκ³ λ΅ λ°›μ",
    "subtitle": "ν„κΈνλ¦„ μµμ°μ„ "
  }
]
```

**μ—λ¬ μ²λ¦¬**: 500 (μ„λ²„ μ—λ¬)

---

#### 2. POST `/api/dividend/all-tiers`
**μ„¤λ…**: νΉμ • ν…λ§μ— λ€ν• 3κ° ν‹°μ–΄(λ°©μ–΄ν•/κ· ν•ν•/κ³µκ²©ν•) ν¬νΈν΄λ¦¬μ¤ μƒμ„±

**μ”μ²­ λ³Έλ¬Έ**:
```json
{
  "theme_id": "max_monthly_income",
  "target_monthly_krw": 1000000,
  "fx_rate": 1420,
  "tax_rate": 15.4,
  "optimize_mode": "greedy"
}
```

**μ‘λ‹µ ν•μ‹**:
```json
{
  "defensive": { ... },
  "balanced": { ... },
  "aggressive": { ... }
}
```

**μ—λ¬ μ²λ¦¬**: 500 (μ„λ²„ μ—λ¬)

---

#### 3. GET `/api/dividend/risk-metrics/<ticker>`
**μ„¤λ…**: νΉμ • ν‹°μ»¤μ λ¦¬μ¤ν¬ μ§€ν‘ μ΅°ν

**μΏΌλ¦¬ νλΌλ―Έν„°**:
- `period` (μ„ νƒ): `1y`, `2y` λ“± (κΈ°λ³Έκ°’: `1y`)

**μ‘λ‹µ ν•μ‹**:
```json
{
  "ticker": "AAPL",
  "volatility_annual": 0.20,
  "max_drawdown": -0.15,
  "sharpe_ratio": 1.5,
  "risk_grade": "B"
}
```

**μ—λ¬ μ²λ¦¬**: 500 (μ„λ²„ μ—λ¬)

---

#### 4. GET `/api/dividend/sustainability/<ticker>`
**μ„¤λ…**: λ°°λ‹Ή μ§€μ†κ°€λ¥μ„± λ¶„μ„

**μ‘λ‹µ ν•μ‹**:
```json
{
  "payout_ratio": 0.5,
  "dividend_growth_5y": 0.05,
  "dividend_streak": 10,
  "safety": {
    "safety_score": 75,
    "safety_grade": "B"
  }
}
```

**μ—λ¬ μ²λ¦¬**: 500 (μ„λ²„ μ—λ¬)

---

#### 5. POST `/api/dividend/optimize-advanced`
**μ„¤λ…**: κ³ κΈ‰ ν¬νΈν΄λ¦¬μ¤ μµμ ν™”

**μ”μ²­ λ³Έλ¬Έ**:
```json
{
  "theme_id": "max_monthly_income",
  "tier_id": "balanced",
  "target_monthly_krw": 1000000,
  "fx_rate": 1420,
  "tax_rate": 15.4,
  "optimize_mode": "risk_parity"
}
```

**μ‘λ‹µ ν•μ‹**: ν¬νΈν΄λ¦¬μ¤ κ°μ²΄

**μ—λ¬ μ²λ¦¬**: 500 (μ„λ²„ μ—λ¬)

---

#### 6. POST `/api/dividend/backtest`
**μ„¤λ…**: ν¬νΈν΄λ¦¬μ¤ λ°±ν…μ¤νΈ μ‹¤ν–‰

**μ”μ²­ λ³Έλ¬Έ**:
```json
{
  "portfolio": [
    {"ticker": "AAPL", "weight": 0.5},
    {"ticker": "MSFT", "weight": 0.5}
  ],
  "start_date": "2022-01-01",
  "end_date": "2022-12-31",
  "initial_capital": 100000
}
```

**μ‘λ‹µ ν•μ‹**:
```json
{
  "total_return": 0.10,
  "cagr": 0.10,
  "max_drawdown": -0.05,
  "sharpe_ratio": 1.5,
  "alpha": 0.02
}
```

**μ—λ¬ μ²λ¦¬**: 
- 400: ν¬νΈν΄λ¦¬μ¤ ν•„μ
- 500: μ„λ²„ μ—λ¬

---

## π§ ν…μ¤νΈ κ³„ν

### 1. λ‹¨μ„ ν…μ¤νΈ (Unit Tests)

#### DividendEngine ν…μ¤νΈ
- β… μ΄κΈ°ν™” κ²€μ¦
- β… ν…λ§ λ©λ΅ μ΅°ν
- β… ν¬νΈν΄λ¦¬μ¤ μƒμ„± (μ ν¨/λ¬΄ν¨ νλΌλ―Έν„°)
- β… ν•„ν„°λ§ λ° μ μ•½ μ΅°κ±΄ κ²€μ¦
- β… μλ³Έ μ”κµ¬μ‚¬ν•­ κ³„μ‚°

#### DividendAnalyzer ν…μ¤νΈ
- β… Payout Ratio κ³„μ‚°
- β… λ°°λ‹Ή μ„±μ¥λ¥  κ³„μ‚°
- β… λ°°λ‹Ή μ—°μ† μ§€κΈ‰ μ—°μ
- β… μ•μ „μ„± μ μ κ³„μ‚°

#### PortfolioOptimizer ν…μ¤νΈ
- β… Risk Parity μµμ ν™”
- β… Max Sharpe μµμ ν™”
- β… μ μ•½ μ΅°κ±΄ μ²λ¦¬

#### RiskAnalytics ν…μ¤νΈ
- β… λ³€λ™μ„± κ³„μ‚°
- β… μµλ€ λ‚™ν­ κ³„μ‚°
- β… Sharpe Ratio κ³„μ‚°

#### BacktestEngine ν…μ¤νΈ
- β… λ°±ν…μ¤νΈ μ‹¤ν–‰
- β… μμµλ¥  κ³„μ‚°
- β… λ²¤μΉλ§ν¬ λΉ„κµ

### 2. ν†µν•© ν…μ¤νΈ (Integration Tests)

#### Flask API μ—”λ“ν¬μΈνΈ ν…μ¤νΈ
- β… λ¨λ“  μ—”λ“ν¬μΈνΈ μ‘λ‹µ κ²€μ¦
- β… μ”μ²­/μ‘λ‹µ ν•μ‹ κ²€μ¦
- β… μ—λ¬ ν•Έλ“¤λ§ κ²€μ¦
- β… μ—£μ§€ μΌ€μ΄μ¤ μ²λ¦¬

### 3. API ν…μ¤νΈ μ‹λ‚λ¦¬μ¤

#### μ‹λ‚λ¦¬μ¤ 1: μ •μƒ ν”λ΅μ°
1. ν…λ§ λ©λ΅ μ΅°ν β†’ μ„±κ³µ
2. ν¬νΈν΄λ¦¬μ¤ μƒμ„± β†’ μ„±κ³µ
3. λ¦¬μ¤ν¬ λ©”νΈλ¦­ μ΅°ν β†’ μ„±κ³µ
4. λ°±ν…μ¤νΈ μ‹¤ν–‰ β†’ μ„±κ³µ

#### μ‹λ‚λ¦¬μ¤ 2: μ—λ¬ μ²λ¦¬
1. μλ»λ ν…λ§ ID β†’ μ—λ¬ μ‘λ‹µ
2. μλ»λ ν‹°μ–΄ ID β†’ μ—λ¬ μ‘λ‹µ
3. ν¬νΈν΄λ¦¬μ¤ μ—†μ΄ λ°±ν…μ¤νΈ β†’ 400 μ—λ¬
4. μ΅΄μ¬ν•μ§€ μ•λ” ν‹°μ»¤ β†’ μ—λ¬ μ‘λ‹µ

#### μ‹λ‚λ¦¬μ¤ 3: μ—£μ§€ μΌ€μ΄μ¤
1. λΉ μ”μ²­ λ³Έλ¬Έ
2. μµμ†/μµλ€ κ°’ ν…μ¤νΈ
3. νΉμ λ¬Έμ μ²λ¦¬
4. λ§¤μ° ν° μ«μ μ²λ¦¬

---

## π” μ½”λ“ ν’μ§ λ¶„μ„

### κ°•μ 

1. **λ¨λ“ν™”**: κ° κΈ°λ¥μ΄ λ…ν™•ν•κ² λ¶„λ¦¬λ¨
2. **μ—λ¬ ν•Έλ“¤λ§**: λ€λ¶€λ¶„μ ν•¨μμ—μ„ μμ™Έ μ²λ¦¬ κµ¬ν„
3. **νƒ€μ… ννΈ**: ν•¨μ μ‹κ·Έλ‹μ²μ— νƒ€μ… ννΈ μ‚¬μ©
4. **μ„¤μ • κ΄€λ¦¬**: JSON νμΌμ„ ν†µν• μ„¤μ • κ΄€λ¦¬
5. **ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€**: ν¬κ΄„μ μΈ ν…μ¤νΈ μ¤μ„νΈ μ΅΄μ¬

### κ°μ„  κ°€λ¥ μμ—­

1. **μμ΅΄μ„± κ΄€λ¦¬**: 
   - yfinanceμ— λ€ν• μμ΅΄μ„±μ΄ λ§μ
   - Mockμ„ λ” μ κ·Ήμ μΌλ΅ ν™μ© κ¶μ¥

2. **μ—λ¬ λ©”μ‹μ§€**:
   - μΌλ¶€ μ—λ¬ λ©”μ‹μ§€κ°€ μΌλ°μ μ„
   - λ” κµ¬μ²΄μ μΈ μ—λ¬ λ©”μ‹μ§€ μ κ³µ κ¶μ¥

3. **λ΅κΉ…**:
   - λ΅κΉ…μ΄ μ„¤μ •λμ–΄ μμΌλ‚ μΌκ΄€μ„± κ°μ„  κ°€λ¥

4. **API λ¬Έμ„ν™”**:
   - OpenAPI/Swagger μ¤ν™ μ¶”κ°€ κ¶μ¥

5. **μΈμ¦/μΈκ°€**:
   - ν„μ¬ μΈμ¦ λ©”μ»¤λ‹μ¦μ΄ μ—†μ
   - ν”„λ΅λ•μ… ν™κ²½μ—μ„λ” μΈμ¦ μ¶”κ°€ ν•„μ”

---

## π“ ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€ ν„ν™©

### ν„μ¬ ν…μ¤νΈ νμΌ

- β… `test_engine.py` (11κ° ν…μ¤νΈ)
- β… `test_dividend_analyzer.py` (10κ° ν…μ¤νΈ)
- β… `test_portfolio_optimizer.py` (8κ° ν…μ¤νΈ)
- β… `test_risk_analytics.py` (8κ° ν…μ¤νΈ)
- β… `test_backtest.py` (6κ° ν…μ¤νΈ)
- β… `test_flask_api.py` (13κ° ν…μ¤νΈ)

**μ΄ ν…μ¤νΈ μ**: 56κ°

### μ»¤λ²„λ¦¬μ§€ μμ—­

- β… ν•µμ‹¬ λΉ„μ¦λ‹μ¤ λ΅μ§
- β… API μ—”λ“ν¬μΈνΈ
- β… μ—λ¬ ν•Έλ“¤λ§
- β… μ—£μ§€ μΌ€μ΄μ¤
- β οΈ μ„±λ¥ ν…μ¤νΈ (λ¶€μ΅±)
- β οΈ λ¶€ν• ν…μ¤νΈ (μ—†μ)

---

## π― TestSprite κ¶μ¥ ν…μ¤νΈ

### 1. API μ—”λ“ν¬μΈνΈ ν…μ¤νΈ

```python
# κ° μ—”λ“ν¬μΈνΈμ— λ€ν• ν…μ¤νΈ
- GET /api/dividend/themes
- POST /api/dividend/all-tiers
- GET /api/dividend/risk-metrics/<ticker>
- GET /api/dividend/sustainability/<ticker>
- POST /api/dividend/optimize-advanced
- POST /api/dividend/backtest
```

### 2. λ°μ΄ν„° κ²€μ¦ ν…μ¤νΈ

- μ”μ²­ λ³Έλ¬Έ μ¤ν‚¤λ§ κ²€μ¦
- μ‘λ‹µ ν•μ‹ κ²€μ¦
- ν•„μ ν•„λ“ κ²€μ¦
- λ°μ΄ν„° νƒ€μ… κ²€μ¦

### 3. λΉ„μ¦λ‹μ¤ λ΅μ§ ν…μ¤νΈ

- ν¬νΈν΄λ¦¬μ¤ μƒμ„± λ΅μ§
- μµμ ν™” μ•κ³ λ¦¬μ¦
- λ¦¬μ¤ν¬ κ³„μ‚° μ •ν™•μ„±
- λ°±ν…μ¤νΈ κ²°κ³Ό κ²€μ¦

### 4. μ—λ¬ ν•Έλ“¤λ§ ν…μ¤νΈ

- 400 Bad Request
- 500 Internal Server Error
- λ„¤νΈμ›ν¬ μ—λ¬
- νƒ€μ„μ•„μ›ƒ μ²λ¦¬

---

## π€ μ‹¤ν–‰ κ¶μ¥μ‚¬ν•­

### ν…μ¤νΈ μ‹¤ν–‰

```bash
# λ¨λ“  ν…μ¤νΈ μ‹¤ν–‰
pytest us_market/tests/ -v

# μ»¤λ²„λ¦¬μ§€ ν¬ν•¨
pytest us_market/tests/ --cov=us_market --cov-report=html

# νΉμ • ν…μ¤νΈ νμΌ
pytest us_market/tests/test_flask_api.py -v
```

### μ„λ²„ μ‹¤ν–‰

```bash
# Flask μ„λ²„ μ‹μ‘ (ν¬νΈ 5001)
python flask_app.py
```

### API ν…μ¤νΈ

```bash
# ν…λ§ λ©λ΅ μ΅°ν
curl http://localhost:5001/api/dividend/themes

# ν¬νΈν΄λ¦¬μ¤ μƒμ„±
curl -X POST http://localhost:5001/api/dividend/all-tiers \
  -H "Content-Type: application/json" \
  -d '{"theme_id": "max_monthly_income", "target_monthly_krw": 1000000}'
```

---

## π“ κ²°λ΅ 

### μ½”λ“ κµ¬μ΅° ν‰κ°€: β… μ°μ

- λ…ν™•ν• λ¨λ“ λ¶„λ¦¬
- μΌκ΄€λ μ½”λ“ μ¤νƒ€μΌ
- ν¬κ΄„μ μΈ ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€
- μ μ ν• μ—λ¬ ν•Έλ“¤λ§

### API μ„¤κ³„ ν‰κ°€: β… μ–‘νΈ

- RESTful μ›μΉ™ μ¤€μ
- λ…ν™•ν• μ—”λ“ν¬μΈνΈ κµ¬μ΅°
- μ μ ν• HTTP λ©”μ„λ“ μ‚¬μ©
- JSON κΈ°λ° ν†µμ‹ 

### κ°μ„  κ¶μ¥μ‚¬ν•­

1. API λ¬Έμ„ν™” (OpenAPI/Swagger)
2. μΈμ¦/μΈκ°€ λ©”μ»¤λ‹μ¦ μ¶”κ°€
3. μ„±λ¥ ν…μ¤νΈ μ¶”κ°€
4. λ΅κΉ… κ°μ„ 
5. λ¨λ‹ν„°λ§ λ„κµ¬ ν†µν•©

---

**λ¶„μ„ μ™„λ£ μ‹κ°„**: 2025-01-17  
**λ¶„μ„ λ„κµ¬**: TestSprite (MCP μ—°κ²° λ€κΈ° μ¤‘)  
**ν…μ¤νΈ λ²”μ„**: `us_market` ν΄λ” κΈ°μ¤€
